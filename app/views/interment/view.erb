<%
@document[:title] = "View Interment ##{@allocation.id}"
@document[:page_heading] = print("Interment ##{@allocation.id}") do
  "Interment of #{@allocation.role_by_type('deceased').person.name.titleize}"
end
content_for :head do
%>
  <script type="text/javascript">
    $( function () {
      var multibutton = new Ts.FormViews.Multibutton({
        name: 'action',
        values: {edit: 'Edit', multiple_interment: 'Multiple Interment', delete: 'Delete', print: 'Print'},
        actions: {
          edit: function () {
            window.location = <%= url(:interment_edit, :id => @allocation.id).to_json %>
          },
          multiple_interment: function () {
            window.location = <%= url(:interment_new, :place => @allocation.place_id).to_json %>
          },
          delete: function () {
            if (confirm('Are you sure you want to delete this interment?')) {
              $('<form method="post" />').append($('<input type="hidden" name="_method" value="delete" />')).submit()
            }
          },
          print: function () {
            window.print()
          },
          default: function () {
            alert('This function is not currently implemented.')
          }
        }
      })
      var section = new Ts.FormViews.Section({title: 'Actions', body: multibutton.render().el})
			$('#interment_view').append($(section.render().el).addClass('noprint'))
    })
  </script>
<%
end

include_script_views('form')
%>
<div id="interment_view" class="rowed very_wide view">
  <% @allocation.roles.each do |role| %>
    <section>
      <h2 class="underline"><%= role.type.demodulize.titleize %></h2>
      <div id="<%= role.type %>_section" class="section padded" name="deceased">
        <%= partial 'shared/role_view', :locals => {role: role} %>
      </div>
    </section>
  <% end %>
  <section>
    <h2 class="underline">Location</h2>
    <div id="places_section" class="section padded" name="place">
    <% @allocation.place.ancestors.reverse.push(@allocation.place).each do |place| %>
      <div class="row">
        <span><%= place.type.demodulize.titleize %></span>
        <div><%= place.name %></div>
      </div>
    <% end %>
    </div>
  </section>
  <section>
    <h2 class="underline">Funeral Service</h2>
    <div class="section padded">
      <label>
        <span>Director</span>
        <div><%= print { @allocation.funeral_director.name } %></div>
      </label>
      <label>
        <span>Director Name</span>
        <div><%= print { @allocation.funeral_director_name } %></div>
      </label>
      <label>
        <span>Location</span>
        <div><%= print { @allocation.funeral_service_location } %></div>
      </label>
    </div>
  </section>
  <section>
    <h2 class="underline">Other Details</h2>
    <div class="section padded">
      <label>
        <span>Interment Type</span>
        <div><%= print { @allocation.interment_type.demodulize.titleize } %></div>
      </label>
      <label>
        <span>Advice Received Date</span>
        <div><%= print { @allocation.advice_received_date } %></div>
      </label>
    	<label>
        <span>Interment Date</span>
        <div><%= print { @allocation.interment_date } %></div>
      </label>
      <label>
        <span>Receipt No's</span>
        <div><%= print { @allocation.transactions.map{ |t| t.receipt_no }.join(', ') } %></div>
      </label>
      <label>
        <span class="align_top">Burial Requirements</span>
        <div><%= print { @allocation.burial_requirements } %></div>
      </label>
      <label>
        <span class="align_top">Comments</span>
        <div><%= print { @allocation.comments } %></div>
      </label>
      <label>
        <span>Status</span>
        <div><%= print { @allocation.status.demodulize.titleize } %></div>
      </label>
    </div>
  </section>
  <iframe src="<%= url :"photos_view", :id => @allocation.place.id %>" width="100%" height="100%" scrolling="no" frameborder="0" hspace="0" vspace="0">Browser not compatible.</iframe>
</div>