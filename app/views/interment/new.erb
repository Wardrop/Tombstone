<%
@document[:title] = 'Create Interment'
content_for :head do
%>
  <script type="text/javascript">
    $( function () {
      var roles = {}
      _.each({deceased: 'Deceased', applicant: 'Applicant', next_of_kin: 'Next of Kin'}, function (name, role) {
        roles[role] = new Ts.FormViews.RoleBlock({role_type: role, role_name: name, el: $('#'+role+'_section')})
        roles[role].render()
      })
      
      var rootPlaces = new Ts.Places(<%= @root_places.to_json %>)
      $('#places_section').append(new Ts.FormViews.PlacesView({collection: rootPlaces}).render().el)
      
      var multibutton = new Ts.FormViews.Multibutton({
        name: 'submit',
        values: {pending: 'Submit', approved: 'Approve', interred: 'Inter', completed: 'Complete'}
      })
      $('#actions_section > div').append(multibutton.render().el)
    
      new Ts.FormViews.AllocationForm({el: $('#interment_form'), roles: roles})
    })
  </script>
<%
end

include_script_views('role_wizard', 'form')
%>
<form id="interment_form" class="rowed wide" action="<%= url :interment_new %>">
  <section>
    <h2 class="underline">Deceased</h2>
    <div id="deceased_section" class="section padded" name="deceased"></div>
  </section>
  <section>
    <h2 class="underline">Applicant</h2>
    <div id="applicant_section" class="section padded" name="applicant"></div>
  </section>
  <section>
    <h2 class="underline">Next of Kin</h2>
    <div id="next_of_kin_section" class="section padded" name="next_of_kin"></div>
  </section>
  <section>
    <h2 class="underline">Location</h2>
    <div id="places_section" class="section padded" name="place"></div>
  </section>
  <section>
    <h2 class="underline">Funeral Service</h2>
    <div class="section padded">
      <label>
        <span>Director</span>
        <%= select_tag(:funeral_director, :collection => @funeral_directors, :fields => [:name, :id], :include_blank => '') %>
      </label>
      <label>
        <span>Director Name</span>
        <input type="text" name="funeral_director_name" style="width: 40%" />
      </label>
      <label>
        <span>Location</span>
        <input type="text" name="funeral_service_location" style="width: 60%" />
      </label>
    </div>
  </section>
  <section>
    <h2 class="underline">Other Details</h2>
    <div class="section padded">
      <label>
        <span>Interment Type</span>
        <%= select_tag(:interment_type, :options => Tombstone::Interment.valid_interment_types.map{|v| [v.demodulize.titleize, v]}, :include_blank => '') %>
      </label>
      <label>
        <span>Advice Received Date</span>
        <input type="date" name="advice_received_date" />
      </label>
    	<label>
        <span>Interment Date</span>
        <input type="datetime" name="interment_date" />
      </label>
      <label>
        <span class="align_top">Burial Requirements</span>
        <textarea name="burial_requirements" style="width: 100%; height: 56px;"></textarea>
      </label>
      <label>
        <span class="align_top">Comments</span>
        <textarea name="comments" style="width: 100%; height: 82px;"></textarea>
      </label>
    </div>
  </section>
  <section>
    <h2 class="underline">Actions</h2>
    <div id="actions_section" class="section padded">
      <div class="inline_layout"></div>
    </div>
  </section>
</form>