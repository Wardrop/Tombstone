<%
@document[:title] = 'Find'
content_for :head do %>
  <script type="text/javascript">
    $( function () {
      $('#search_results .clickable').click( function (e) {
        if(e.target.tagName != 'A') {
          if($(this).hasClass('expanded')) {
            $(this).removeClass('expanded')
            $(this).attr('title', 'Click to expand')
          } else {
            $(this).addClass('expanded')
            $(this).attr('title', 'Click to collapse')
          }
        }
      }).attr('title', 'Click to expand')
    })
  </script>
<% end %>
<div>
  <section id="search_defintion">
    <h2 class="underline">Find</h2>
    <form class="inline_layout h_padded" method="GET" action".">
      <label style="width: 68%">
        <input type="text" name="search" placeholder="Search terms..." style="width: 100%"
          title="Valid search fields: <%= Tombstone::Search.searchable.keys.join(', ') %>" />
      </label>
      <label style="width: 20%">
        <select type="text" name="type" style="width: 100%">
          <option value="allocations">Find Allocations</option>
          <option value="people">Find People</option>
          <option value="places">Find Places</option>
        </select>
      </label>
      <label style="text-align: right; width: 12%">
        <input type="submit" class="action_button" value="Search" />
      </label>
    </form>
  </section>
  <section id="search_results">
    <h3 class="underline">
      Results
      <!--
      <div class="heading_float order_options">
        Order By:
        <a href="#">Given Name</a>
        <a href="#">Surname</a>
        <a href="#" class="desc">Created At</a>
        <a href="#">Created By</a>
      </div>
      -->
    </h3>
    <div class="list_rows padded">
    <%=
    if @records.length == 0
      "No records found."
    else
      case @records[0]
      when Tombstone::Allocation
        partial 'find/allocation_records', :locals => {records: @records}
      when Tombstone::Person
        partial 'find/person_records', :locals => {records: @records}
      when Tombstone::Place
        partial 'find/place_records', :locals => {records: @records}
      else
        halt 500, "No view has been configured for the model class `#{@records[0].class}`"
      end
    end
    %>
  </section>
</div>
