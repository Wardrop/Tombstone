<%
@document[:title] = 'Create Reservation'
content_for :head do
%>
  <script type="text/javascript">
    $( function () {
      var roles = {}
      _.each({reservee: 'Reservee', applicant: 'Applicant', next_of_kin: 'Next of Kin'}, function (name, type) {
        roles[type] = new Ts.FormViews.RoleBlock({role_type: type, role_name: name, el: $('#'+type+'_section')})
        roles[type].render()
      })
      
      var rootPlaces = new Ts.Places(<%= @root_places.to_json %>)
      $('#places_section').append(new Ts.FormViews.PlacesView({collection: rootPlaces}).render().el)
      
      var multibutton = new Ts.FormViews.Multibutton({name: 'submit', values: {active: 'Submit'}})
      $('#actions_section > div').append(multibutton.render().el)
    
      new Ts.FormViews.AllocationForm({el: $('#reservation_form')[0], roles: roles})
    })
  </script>
<% end %>
<%= partial 'partials/reservation_form'%>